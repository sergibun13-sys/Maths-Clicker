<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maths Clicker: Genius Edition</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-panel: rgba(30, 41, 59, 0.7);
            --primary: #3b82f6;
            --primary-glow: rgba(59, 130, 246, 0.5);
            --accent: #10b981;
            --danger: #ef4444;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --card-bg: rgba(255, 255, 255, 0.05);
            --grid-color: rgba(255, 255, 255, 0.03);
            --effect-color: #d946ef;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Outfit', sans-serif;
            margin: 0;
            overflow: hidden;
            height: 100vh;
            color: var(--text-main);
            background-color: var(--bg-dark);
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        #mathCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            opacity: 0.6;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            width: 100%;
            height: 100vh;
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .game-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 20px;
            gap: 30px;
        }

        .score-hud {
            text-align: center;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            padding: 25px 50px;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        #score {
            font-size: 5rem;
            font-weight: 800;
            background: linear-gradient(to right, #60a5fa, #c084fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
            margin-bottom: 5px;
            filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.3));
        }

        #rate {
            font-size: 1.1rem;
            color: var(--text-muted);
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .brain-btn-container {
            position: relative;
            width: 340px;
            height: 340px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #btnClick {
            width: 280px;
            height: 280px;
            border-radius: 50%;
            border: none;
            background: radial-gradient(circle at 35% 35%, #60a5fa, #2563eb, #1e40af);
            box-shadow: 
                inset -10px -10px 20px rgba(0,0,0,0.5),
                inset 10px 10px 20px rgba(255,255,255,0.4),
                0 0 0 10px rgba(37, 99, 235, 0.1),
                0 20px 50px rgba(0,0,0,0.5);
            cursor: pointer;
            z-index: 10;
            transition: all 0.15s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        #btnClick:hover {
            transform: scale(1.02);
        }

        #btnClick:active {
            transform: scale(0.95);
        }

        #btnClick span.icon {
            font-size: 5rem;
            animation: floatIcon 3s ease-in-out infinite;
        }

        #btnClick span.text {
            font-size: 1.6rem;
            font-weight: 800;
            letter-spacing: 2px;
            margin-top: 10px;
        }

        #clickPowerText {
            background: rgba(0,0,0,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 8px;
        }

        @keyframes floatIcon {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .shop-panel {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .shop-header {
            padding: 25px;
            background: rgba(15, 23, 42, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .shop-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: white;
        }

        .shop-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .section-header {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--primary);
            margin: 30px 0 15px 0;
            font-weight: 700;
            padding-left: 5px;
            border-left: 3px solid var(--primary);
        }

        .upgrade-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 12px 15px;
            margin-bottom: 12px;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 15px;
            align-items: center;
            cursor: pointer;
            transition: 0.2s;
        }

        .upgrade-card.affordable { border-color: rgba(16, 185, 129, 0.3); border: 1px solid; }

        .icon-box {
            width: 44px; height: 44px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.4rem;
        }

        .btn-buy {
            background: #334155;
            color: #94a3b8;
            border: none; padding: 8px 12px; border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700; min-width: 80px; text-align: right;
        }

        .affordable .btn-buy { background: var(--accent); color: #064e3b; }

        .float-number {
            position: absolute;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 800; font-size: 1.5rem;
            pointer-events: none; color: var(--primary);
            animation: floatUp 0.8s ease-out forwards;
            z-index: 100;
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 0; }
            100% { transform: translateY(-80px); opacity: 0; }
        }

        .floating-btn {
            position: fixed; z-index: 50; border: none; cursor: pointer;
        }

        #btnMusic {
            top: 20px; right: 20px; width: 48px; height: 48px; border-radius: 14px;
            background: rgba(30, 41, 59, 0.8); color: white;
        }

        #btnMathBonus {
            top: 100px; left: 50%; transform: translateX(-50%);
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white; padding: 12px 24px; border-radius: 50px;
            font-weight: 800; display: none;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.5);
            z-index: 200;
        }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(10px);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }

        .modal-content {
            background: #1e293b; padding: 40px; border-radius: 24px; text-align: center; width: 90%; max-width: 400px;
        }

        .option-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px;
        }

        .option-btn {
            background: #334155; color: white; border: none; padding: 20px; border-radius: 16px; font-size: 1.2rem; cursor: pointer;
        }
    </style>
</head>

<body>
    <canvas id="mathCanvas"></canvas>

    <div class="main-layout">
        <div class="game-panel">
            <button id="btnMusic" class="floating-btn" onclick="toggleMusic()">üîá</button>

            <div class="score-hud">
                <div id="score" class="mono">0</div>
                <div id="rate" class="mono">
                    <span style="color:var(--accent)">‚ö°</span>
                    <span id="rateNum">0</span> IQ/seg
                </div>
            </div>

            <button id="btnMathBonus" onclick="showMathProblem()">üéÅ DESAF√çO (+25% IQ)</button>

            <div class="brain-btn-container">
                <button id="btnClick" onmousedown="handleManualClick(event)" ontouchstart="handleManualClick(event)">
                    <span class="icon">üß†</span>
                    <span class="text">ESTUDIAR</span>
                    <span id="clickPowerText" class="mono">+1 IQ</span>
                </button>
            </div>
        </div>

        <div class="shop-panel">
            <div class="shop-header">
                <div class="shop-title">üìö Tienda Acad√©mica</div>
            </div>
            <div class="shop-content">
                <div class="section-header">Mejoras de Click</div>
                <div id="clickUpgradesList"></div>
                <div class="section-header">Mejoras Autom√°ticas</div>
                <div id="autoUpgradesList"></div>
            </div>
        </div>
    </div>

    <div id="modalOverlay" class="modal-overlay">
        <div class="modal-content">
            <h2 style="color:var(--primary);">üß† BONUS COGNITIVO</h2>
            <p>Resuelve para ganar el 25% de tu IQ total</p>
            <p id="mathQuestion" class="mono" style="font-size: 2.2rem; margin: 20px 0; color: white;">¬ø?</p>
            <div id="mathOptions" class="option-grid"></div>
        </div>
    </div>

    <script>
        // Configuraci√≥n id√©ntica a la anterior para los items
        const upgradesConfig = [
            { id: 'c1', type: 'click', name: 'L√°piz HB', icon: '‚úèÔ∏è', basePrice: 15, power: 1 },
            { id: 'c2', type: 'click', name: 'Subrayador', icon: 'üñçÔ∏è', basePrice: 80, power: 4 },
            { id: 'c3', type: 'click', name: 'Regla T', icon: 'üìè', basePrice: 250, power: 12 },
            { id: 'c4', type: 'click', name: 'Calculadora', icon: 'üìü', basePrice: 800, power: 35 },
            { id: 'c5', type: 'click', name: 'Libro F√≥rmulas', icon: 'üìò', basePrice: 2000, power: 90 },
            { id: 'c6', type: 'click', name: 'Microscopio', icon: 'üî¨', basePrice: 6000, power: 250 },
            { id: 'c7', type: 'click', name: 'Superordenador', icon: 'üñ•Ô∏è', basePrice: 18000, power: 700 },
            { id: 'c8', type: 'click', name: 'Chip Cognitivo', icon: 'üíæ', basePrice: 50000, power: 1800 },
            { id: 'c9', type: 'click', name: 'Enlace Neural', icon: 'üîó', basePrice: 150000, power: 5000 },
            { id: 'c10', type: 'click', name: 'ADN Sint√©tico', icon: 'üß¨', basePrice: 500000, power: 15000 },
            { id: 'c11', type: 'click', name: 'IA Predictiva', icon: 'ü§ñ', basePrice: 2000000, power: 50000 },
            { id: 'c12', type: 'click', name: 'Nube Mental', icon: '‚òÅÔ∏è', basePrice: 10000000, power: 200000 },
            { id: 'c13', type: 'click', name: 'Qubits Org√°nicos', icon: 'üí†', basePrice: 50000000, power: 800000 },
            { id: 'c14', type: 'click', name: 'Cerebro Matriz', icon: 'üåê', basePrice: 250000000, power: 3000000 },
            { id: 'c15', type: 'click', name: 'Omnisciencia', icon: 'üëÅÔ∏è', basePrice: 1000000000, power: 15000000 },
            { id: 'a1', type: 'auto', name: 'Notas Adhesivas', icon: 'üóíÔ∏è', basePrice: 25, power: 1 },
            { id: 'a2', type: 'auto', name: 'Apuntes Prestados', icon: 'üìë', basePrice: 150, power: 6 },
            { id: 'a3', type: 'auto', name: 'Grupo de Estudio', icon: 'üë•', basePrice: 800, power: 20 },
            { id: 'a4', type: 'auto', name: 'Tutor Privado', icon: 'üë®‚Äçüè´', basePrice: 3000, power: 65 },
            { id: 'a5', type: 'auto', name: 'Curso Online', icon: 'üíª', basePrice: 10000, power: 180 },
            { id: 'a6', type: 'auto', name: 'Biblioteca', icon: 'üèõÔ∏è', basePrice: 35000, power: 500 },
            { id: 'a7', type: 'auto', name: 'Centro I+D', icon: 'üè¢', basePrice: 120000, power: 1500 },
            { id: 'a8', type: 'auto', name: 'Laboratorio Alfa', icon: '‚öóÔ∏è', basePrice: 400000, power: 4500 },
            { id: 'a9', type: 'auto', name: 'Uni Global', icon: 'üéì', basePrice: 1500000, power: 15000 },
            { id: 'a10', type: 'auto', name: 'Santuario Zen', icon: 'üßò', basePrice: 6000000, power: 55000 },
            { id: 'a11', type: 'auto', name: 'Colisionador', icon: '‚öõÔ∏è', basePrice: 25000000, power: 200000 },
            { id: 'a12', type: 'auto', name: 'Sat√©lite Edu', icon: 'üõ∞Ô∏è', basePrice: 120000000, power: 850000 },
            { id: 'a13', type: 'auto', name: 'Academia Espacial', icon: 'ü™ê', basePrice: 600000000, power: 4000000 },
            { id: 'a14', type: 'auto', name: 'Mente Enjambre', icon: 'üß†', basePrice: 3000000000, power: 18000000 },
            { id: 'a15', type: 'auto', name: 'Simulaci√≥n Total', icon: 'üåå', basePrice: 15000000000, power: 100000000 },
        ];

        let gameState = { iq: 0, clickPower: 1, autoRate: 0, upgrades: {} };
        upgradesConfig.forEach(u => gameState.upgrades[u.id] = 0);

        // --- AUDIO (NUEVA M√öSICA) ---
        let audioCtx = null;
        let isPlaying = false;
        let nextNoteTime = 0;
        let melodyStep = 0;
        const scale = [261.63, 293.66, 311.13, 349.23, 392.00, 415.30, 466.16, 523.25]; // Escala Menor

        function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
        
        function playNote(freq, time, dur = 0.5) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(freq, time);
            gainNode.gain.setValueAtTime(0, time);
            gainNode.gain.linearRampToValueAtTime(0.05, time + 0.02);
            gainNode.gain.exponentialRampToValueAtTime(0.001, time + dur);
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.start(time);
            osc.stop(time + dur);
        }

        function musicScheduler() {
            while (nextNoteTime < audioCtx.currentTime + 0.1) {
                // Secuencia m√°s r√≠tmica y compleja
                const noteIndex = melodyStep % scale.length;
                playNote(scale[noteIndex], nextNoteTime, 0.3);
                
                // Bajo ocasional
                if(melodyStep % 4 === 0) playNote(scale[0] / 2, nextNoteTime, 0.6);
                
                nextNoteTime += 0.25; // Ritmo constante
                melodyStep++;
            }
            if (isPlaying) requestAnimationFrame(musicScheduler);
        }

        function toggleMusic() {
            const btn = document.getElementById('btnMusic');
            if (isPlaying) { 
                isPlaying = false; btn.innerHTML = 'üîá'; audioCtx.suspend(); 
            } else { 
                initAudio(); audioCtx.resume(); isPlaying = true; 
                nextNoteTime = audioCtx.currentTime; 
                melodyStep = 0;
                musicScheduler(); 
                btn.innerHTML = 'üéµ'; 
            }
        }

        // --- L√ìGICA CORE ---
        function formatNum(n) {
            if (n >= 1e12) return (n / 1e12).toFixed(2) + "T";
            if (n >= 1e9) return (n / 1e9).toFixed(2) + "B";
            if (n >= 1e6) return (n / 1e6).toFixed(2) + "M";
            if (n >= 1e3) return (n / 1e3).toFixed(1) + "k";
            return Math.floor(n).toLocaleString();
        }

        function updateStats() {
            let cp = 1, ar = 0;
            upgradesConfig.forEach(u => {
                let lvl = gameState.upgrades[u.id];
                if (u.type === 'click') cp += u.power * lvl;
                else ar += u.power * lvl;
            });
            gameState.clickPower = cp;
            gameState.autoRate = ar;
        }

        function renderShop() {
            const listC = document.getElementById('clickUpgradesList');
            const listA = document.getElementById('autoUpgradesList');
            listC.innerHTML = ''; listA.innerHTML = '';

            upgradesConfig.forEach(u => {
                const lvl = gameState.upgrades[u.id];
                const price = Math.floor(u.basePrice * Math.pow(1.15, lvl));
                const canBuy = gameState.iq >= price;

                const div = document.createElement('div');
                div.className = `upgrade-card ${canBuy ? 'affordable' : ''}`;
                div.onclick = () => { if (canBuy) buy(u.id); };

                div.innerHTML = `
                    <div class="icon-box">${u.icon}</div>
                    <div class="card-info">
                        <h4>${u.name} <span class="lvl-badge">Lvl.${lvl}</span></h4>
                        <p>+${formatNum(u.power)} ${u.type === 'click' ? 'Click' : 'IQ/s'}</p>
                    </div>
                    <button class="btn-buy">${formatNum(price)}</button>
                `;
                if (u.type === 'click') listC.appendChild(div);
                else listA.appendChild(div);
            });
        }

        function buy(id) {
            const u = upgradesConfig.find(x => x.id === id);
            const lvl = gameState.upgrades[id];
            const price = Math.floor(u.basePrice * Math.pow(1.15, lvl));
            if (gameState.iq >= price) {
                gameState.iq -= price;
                gameState.upgrades[id]++;
                updateStats();
                updateUI();
                if (isPlaying) playNote(880, audioCtx.currentTime, 0.1);
            }
        }

        function handleManualClick(e) {
            if(e) e.preventDefault();
            gameState.iq += gameState.clickPower;
            updateUI();
            
            let x, y;
            if (e && e.touches) { x = e.touches[0].clientX; y = e.touches[0].clientY; }
            else if (e) { x = e.clientX; y = e.clientY; }
            else { x = window.innerWidth/2; y = window.innerHeight/2; }
            
            createFloatingEffect(x, y, gameState.clickPower);
        }

        function createFloatingEffect(x, y, val) {
            const el = document.createElement('div');
            el.className = 'float-number';
            el.innerText = `+${formatNum(val)}`;
            el.style.left = `${x}px`;
            el.style.top = `${y - 40}px`;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        function updateUI() {
            document.getElementById('score').innerText = formatNum(gameState.iq);
            document.getElementById('rateNum').innerText = formatNum(gameState.autoRate);
            document.getElementById('clickPowerText').innerText = `+${formatNum(gameState.clickPower)} IQ`;
            renderShop();
        }

        // --- CANVAS BACKGROUND ---
        const canvas = document.getElementById('mathCanvas');
        const ctx = canvas.getContext('2d');
        const symbols = ['œÄ', '‚àë', '‚à´', '‚àö', '‚àû', '‚â†', '‚àÜ', 'Œ©', 'Œº', '‚àÇ', '‚àá', '‚àÄ'];
        let canvasW, canvasH, particles = [];

        function resize() { canvasW = canvas.width = window.innerWidth; canvasH = canvas.height = window.innerHeight; }
        window.onresize = resize; resize();

        class Particle {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * canvasW; this.y = canvasH + 20;
                this.speed = 0.4 + Math.random();
                this.s = symbols[Math.floor(Math.random() * symbols.length)];
                this.opacity = 0; this.size = 14 + Math.random() * 12;
            }
            update() {
                this.y -= this.speed;
                if (this.y < canvasH * 0.8) this.opacity = Math.min(this.opacity + 0.01, 0.3);
                if (this.y < 50) this.opacity -= 0.01;
                if (this.y < -30 || this.opacity < 0) this.reset();
            }
            draw() {
                ctx.fillStyle = `rgba(56, 189, 248, ${this.opacity})`;
                ctx.font = `${this.size}px 'JetBrains Mono'`;
                ctx.fillText(this.s, this.x, this.y);
            }
        }
        for(let i=0; i<30; i++) particles.push(new Particle());
        function animate() {
            ctx.clearRect(0,0,canvasW,canvasH);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animate);
        }
        animate();

        // --- LOOPS Y BONUS ---
        setInterval(() => {
            if (gameState.autoRate > 0) { gameState.iq += gameState.autoRate; updateUI(); }
        }, 1000);

        // BONUS CADA MINUTO (60 Segundos)
        setInterval(() => {
            const b = document.getElementById('btnMathBonus');
            b.style.display = 'block'; 
            setTimeout(() => b.style.display = 'none', 10000); // Desaparece tras 10s si no se pulsa
        }, 60000);

        function showMathProblem() {
            document.getElementById('btnMathBonus').style.display = 'none';
            const n1 = Math.floor(Math.random()*90)+10;
            const n2 = Math.floor(Math.random()*90)+10;
            const ans = n1 + n2;
            document.getElementById('mathQuestion').innerText = `${n1} + ${n2} = ?`;
            
            const opts = new Set([ans]);
            while(opts.size < 4) opts.add(ans + (Math.floor(Math.random()*30)-15));
            
            const div = document.getElementById('mathOptions'); div.innerHTML = '';
            Array.from(opts).sort(()=>Math.random()-0.5).forEach(o => {
                const b = document.createElement('button'); b.className = 'option-btn'; b.innerText = o;
                b.onclick = () => {
                    document.getElementById('modalOverlay').style.display = 'none';
                    if(o === ans) { 
                        // RECOMPENSA: 25% del IQ Actual o un m√≠nimo base
                        const bonusAmount = Math.max(100, Math.floor(gameState.iq * 0.25));
                        gameState.iq += bonusAmount; 
                        updateUI();
                        createFloatingEffect(window.innerWidth/2, window.innerHeight/2, bonusAmount);
                    }
                };
                div.appendChild(b);
            });
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        updateStats();
        updateUI();
    </script>
</body>
</html>
